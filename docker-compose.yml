version: '2'

services:
  postgres:
    image: postgres:9.6.5
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: 
    ports:
      - '5432'
    volumes:
      - mmt-postgres:/var/lib/postgresql/data
  
  #redis:
  # image: redis:3.0.5
  # expose:
  #   - '6379'
  #  volumes:
  #    - mmt-redis:/var/lib/redis/data
  
  mmt:
    build: .
    depends_on:
      - postgres
        #    - redis
    volumes:
      - .:/mmt
    entrypoint: docker/entrypoint.sh
    environment:
      DATABASE_URL: postgres
    ports:
      - "3000:80"

  #sidekiq:
  #  build: .
  #  command: bundle exec sidekiq -C config/sidekiq.yml
  #  links:
  #    - postgres
  #      #    - redis
  #  volumes:
  #    - .:/mmt
  #  env_file:
  #    - .mmt.env
volumes:
  mmt-postgres:
